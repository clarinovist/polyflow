generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String              @id @default(uuid())
  email                   String              @unique
  name                    String?
  password                String
  role                    Role                @default(WAREHOUSE)
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt
  locale                  String              @default("en")
  auditLogs               AuditLog[]
  deliveryOrders          DeliveryOrder[]     @relation("DeliveryCreator")
  goodsReceipts           GoodsReceipt[]      @relation("GoodsReceiptCreator")
  approvedJournals        JournalEntry[]      @relation("JournalApprover")
  createdJournals         JournalEntry[]      @relation("JournalCreator")
  downtimeLogs            MachineDowntime[]
  materialIssues          MaterialIssue[]
  productionCreator       ProductionOrder[]   @relation("ProductionCreator")
  purchaseOrders          PurchaseOrder[]     @relation("PurchaseCreator")
  purchasePayments        PurchasePayment[]   @relation("PaymentCreator")
  createdPurchaseRequests PurchaseRequest[]
  inspections             QualityInspection[]
  salesOrders             SalesOrder[]        @relation("SalesCreator")
  quotations              SalesQuotation[]    @relation("QuotationCreator")
  scrapRecords            ScrapRecord[]
  movements               StockMovement[]
  opnames                 StockOpname[]
  reportedIssues          ProductionIssue[] @relation("IssueReporter")
}

model Employee {
  id                   String                @id @default(uuid())
  name                 String
  code                 String                @unique
  role                 String
  status               EmployeeStatus        @default(ACTIVE)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  hourlyRate           Decimal               @default(0) @db.Decimal(10, 2)
  executionsAsOperator ProductionExecution[] @relation("ExecutionOperator")
  shiftsAsOperator     ProductionShift[]     @relation("ShiftOperator")
  shiftsAsHelper       ProductionShift[]     @relation("ShiftHelpers")
}

model ProductionShift {
  id                String          @id @default(uuid())
  productionOrderId String
  shiftName         String
  startTime         DateTime
  endTime           DateTime
  operatorId        String?
  outputQuantity    Decimal?        @db.Decimal(15, 4)
  notes             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  operator          Employee?       @relation("ShiftOperator", fields: [operatorId], references: [id])
  productionOrder   ProductionOrder @relation(fields: [productionOrderId], references: [id])
  helpers           Employee[]      @relation("ShiftHelpers")
}

model Supplier {
  id               String            @id @default(uuid())
  name             String
  code             String?           @unique
  phone            String?
  email            String?
  address          String?
  taxId            String?
  paymentTermDays  Int?
  bankName         String?
  bankAccount      String?
  notes            String?
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  productVariants  ProductVariant[]  @relation("PreferredSupplier")
  purchaseOrders   PurchaseOrder[]
  supplierProducts SupplierProduct[]
}

model Customer {
  id              String           @id @default(uuid())
  name            String
  code            String?          @unique
  phone           String?
  email           String?
  billingAddress  String?
  shippingAddress String?
  taxId           String?
  creditLimit     Decimal?         @db.Decimal(15, 2)
  paymentTermDays Int?
  discountPercent Decimal?         @db.Decimal(5, 2)
  notes           String?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  salesOrders     SalesOrder[]
  quotations      SalesQuotation[]
}

model Location {
  id               String             @id @default(uuid())
  name             String
  slug             String             @unique
  description      String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  Batch            Batch[]
  deliveryOrders   DeliveryOrder[]
  fixedAssets      FixedAsset[]
  goodsReceipts    GoodsReceipt[]
  inventories      Inventory[]
  machines         Machine[]
  MaterialIssue    MaterialIssue[]
  ProductionOrder  ProductionOrder[]
  salesOrders      SalesOrder[]       @relation("SalesSourceLocation")
  ScrapRecord      ScrapRecord[]
  movementsFrom    StockMovement[]    @relation("FromLocation")
  movementsTo      StockMovement[]    @relation("ToLocation")
  opnames          StockOpname[]
  StockReservation StockReservation[]
}

model Product {
  id                 String           @id @default(uuid())
  name               String
  productType        ProductType
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  cogsAccountId      String?
  inventoryAccountId String?
  revenueAccountId   String?
  wipAccountId       String?
  variants           ProductVariant[]
}

model ProductVariant {
  id                   String                @id @default(uuid())
  productId            String
  name                 String
  skuCode              String                @unique
  price                Decimal?              @db.Decimal(10, 2)
  buyPrice             Decimal?              @db.Decimal(10, 2)
  sellPrice            Decimal?              @db.Decimal(10, 2)
  primaryUnit          Unit
  salesUnit            Unit?
  conversionFactor     Decimal               @default(1.0) @db.Decimal(10, 4)
  attributes           Json?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  minStockAlert        Decimal?              @db.Decimal(15, 4)
  leadTimeDays         Int?
  preferredSupplierId  String?
  reorderPoint         Decimal?              @db.Decimal(15, 4)
  reorderQuantity      Decimal?              @db.Decimal(15, 4)
  costingMethod        CostingMethod         @default(WEIGHTED_AVERAGE)
  standardCost         Decimal?              @db.Decimal(15, 4)
  Batch                Batch[]
  productionBoms       Bom[]                 @relation("ProductBom")
  ingredientInBoms     BomItem[]             @relation("Ingredient")
  deliveryOrderItems   DeliveryOrderItem[]
  goodsReceiptItems    GoodsReceiptItem[]
  inventories          Inventory[]
  MaterialIssue        MaterialIssue[]
  preferredSupplier    Supplier?             @relation("PreferredSupplier", fields: [preferredSupplierId], references: [id])
  product              Product               @relation(fields: [productId], references: [id])
  productionMaterials  ProductionMaterial[]
  purchaseOrderItems   PurchaseOrderItem[]
  purchaseRequestItems PurchaseRequestItem[]
  salesOrderItems      SalesOrderItem[]
  quotationItems       SalesQuotationItem[]
  ScrapRecord          ScrapRecord[]
  movements            StockMovement[]
  opnameItems          StockOpnameItem[]
  StockReservation     StockReservation[]
  supplierProducts     SupplierProduct[]
}

model SupplierProduct {
  id               String         @id @default(uuid())
  productVariantId String
  unitPrice        Decimal?       @db.Decimal(15, 4)
  leadTimeDays     Int?
  minOrderQty      Decimal?       @db.Decimal(15, 4)
  isPreferred      Boolean        @default(false)
  notes            String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  supplierId       String
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
  supplier         Supplier       @relation(fields: [supplierId], references: [id])

  @@unique([supplierId, productVariantId])
}

model Bom {
  id               String            @id @default(uuid())
  name             String
  description      String?
  productVariantId String
  outputQuantity   Decimal           @default(1.0) @db.Decimal(10, 4)
  isDefault        Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  category         BomCategory       @default(STANDARD)
  productVariant   ProductVariant    @relation("ProductBom", fields: [productVariantId], references: [id])
  items            BomItem[]
  ProductionOrder  ProductionOrder[]
}

model BomItem {
  id               String         @id @default(uuid())
  bomId            String
  productVariantId String
  quantity         Decimal        @db.Decimal(10, 4)
  scrapPercentage  Decimal?       @db.Decimal(5, 2)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  bom              Bom            @relation(fields: [bomId], references: [id], onDelete: Cascade)
  productVariant   ProductVariant @relation("Ingredient", fields: [productVariantId], references: [id])
}

model StockMovement {
  id               String         @id @default(uuid())
  type             MovementType
  productVariantId String
  fromLocationId   String?
  toLocationId     String?
  quantity         Decimal        @db.Decimal(15, 4)
  reference        String?
  createdById      String?
  createdAt        DateTime       @default(now())
  batchId          String?
  cost             Decimal?       @db.Decimal(15, 4)
  salesOrderId     String?
  goodsReceiptId   String?
  batch            Batch?         @relation(fields: [batchId], references: [id])
  createdBy        User?          @relation(fields: [createdById], references: [id])
  fromLocation     Location?      @relation("FromLocation", fields: [fromLocationId], references: [id])
  goodsReceipt     GoodsReceipt?  @relation("GoodsReceiptMovement", fields: [goodsReceiptId], references: [id])
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
  salesOrder       SalesOrder?    @relation("SalesMovement", fields: [salesOrderId], references: [id])
  toLocation       Location?      @relation("ToLocation", fields: [toLocationId], references: [id])
}

model Inventory {
  id               String         @id @default(uuid())
  locationId       String
  productVariantId String
  quantity         Decimal        @default(0) @db.Decimal(15, 4)
  updatedAt        DateTime       @updatedAt
  averageCost      Decimal?       @db.Decimal(15, 4)
  location         Location       @relation(fields: [locationId], references: [id])
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])

  @@unique([locationId, productVariantId])
}

model Machine {
  id              String                @id @default(uuid())
  name            String
  code            String                @unique
  type            MachineType
  locationId      String
  status          MachineStatus         @default(ACTIVE)
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  costPerHour     Decimal               @default(0) @db.Decimal(10, 2)
  location        Location              @relation(fields: [locationId], references: [id])
  downtimeLogs    MachineDowntime[]
  executions      ProductionExecution[]
  ProductionOrder ProductionOrder[]
}

model Batch {
  id                String          @id @default(uuid())
  batchNumber       String          @unique
  productVariantId  String
  locationId        String
  quantity          Decimal         @db.Decimal(15, 4)
  manufacturingDate DateTime
  expiryDate        DateTime?
  status            BatchStatus     @default(ACTIVE)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  location          Location        @relation(fields: [locationId], references: [id])
  productVariant    ProductVariant  @relation(fields: [productVariantId], references: [id])
  materialIssues    MaterialIssue[]
  movements         StockMovement[]
}

model StockReservation {
  id               String            @id @default(uuid())
  productVariantId String
  locationId       String
  quantity         Decimal           @db.Decimal(15, 4)
  reservedFor      ReservationType
  referenceId      String
  reservedUntil    DateTime?
  status           ReservationStatus @default(ACTIVE)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  location         Location          @relation(fields: [locationId], references: [id])
  productVariant   ProductVariant    @relation(fields: [productVariantId], references: [id])
}

model StockOpname {
  id          String            @id @default(uuid())
  locationId  String
  status      OpnameStatus      @default(OPEN)
  remarks     String?
  createdById String?
  createdAt   DateTime          @default(now())
  completedAt DateTime?
  updatedAt   DateTime          @updatedAt
  createdBy   User?             @relation(fields: [createdById], references: [id])
  location    Location          @relation(fields: [locationId], references: [id])
  items       StockOpnameItem[]
}

model StockOpnameItem {
  id               String         @id @default(uuid())
  opnameId         String
  productVariantId String
  systemQuantity   Decimal        @db.Decimal(15, 4)
  countedQuantity  Decimal?       @db.Decimal(15, 4)
  notes            String?
  opname           StockOpname    @relation(fields: [opnameId], references: [id])
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])

  @@unique([opnameId, productVariantId])
}

model ProductionOrder {
  id                      String                @id @default(uuid())
  orderNumber             String                @unique
  bomId                   String
  plannedQuantity         Decimal               @db.Decimal(15, 4)
  plannedStartDate        DateTime
  plannedEndDate          DateTime?
  actualQuantity          Decimal?              @db.Decimal(15, 4)
  actualStartDate         DateTime?
  actualEndDate           DateTime?
  status                  ProductionStatus      @default(DRAFT)
  machineId               String?
  locationId              String
  createdById             String?
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  notes                   String?
  salesOrderId            String?
  estimatedConversionCost Decimal?              @db.Decimal(15, 2)
  parentOrderId           String?
  materialIssues          MaterialIssue[]
  executions              ProductionExecution[]
  plannedMaterials        ProductionMaterial[]
  bom                     Bom                   @relation(fields: [bomId], references: [id])
  createdBy               User?                 @relation("ProductionCreator", fields: [createdById], references: [id])
  location                Location              @relation(fields: [locationId], references: [id])
  machine                 Machine?              @relation(fields: [machineId], references: [id])
  parentOrder             ProductionOrder?      @relation("OrderHierarchy", fields: [parentOrderId], references: [id])
  childOrders             ProductionOrder[]     @relation("OrderHierarchy")
  salesOrder              SalesOrder?           @relation("SalesProduction", fields: [salesOrderId], references: [id])
  shifts                  ProductionShift[]
  inspections             QualityInspection[]
  scrapRecords            ScrapRecord[]
  issues                  ProductionIssue[]
}

model MachineDowntime {
  id          String    @id @default(uuid())
  machineId   String
  reason      String
  startTime   DateTime
  endTime     DateTime?
  createdById String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  createdBy   User?     @relation(fields: [createdById], references: [id])
  machine     Machine   @relation(fields: [machineId], references: [id])

  @@index([machineId])
}

model MaterialIssue {
  id                String          @id @default(uuid())
  productionOrderId String
  productVariantId  String
  quantity          Decimal         @db.Decimal(15, 4)
  issuedAt          DateTime        @default(now())
  createdById       String?
  batchId           String?
  locationId        String?
  batch             Batch?          @relation(fields: [batchId], references: [id])
  createdBy         User?           @relation(fields: [createdById], references: [id])
  location          Location?       @relation(fields: [locationId], references: [id])
  productVariant    ProductVariant  @relation(fields: [productVariantId], references: [id])
  productionOrder   ProductionOrder @relation(fields: [productionOrderId], references: [id])
}

model ProductionIssue {
  id                String              @id @default(uuid())
  productionOrderId String
  category          ProductionIssueType
  description       String
  status            IssueStatus         @default(OPEN)
  reportedAt        DateTime            @default(now())
  resolvedAt        DateTime?
  resolvedNotes     String?
  reportedById      String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  productionOrder   ProductionOrder     @relation(fields: [productionOrderId], references: [id], onDelete: Cascade)
  reportedBy        User?               @relation("IssueReporter", fields: [reportedById], references: [id])

  @@index([productionOrderId])
}

model ScrapRecord {
  id                String          @id @default(uuid())
  productionOrderId String
  productVariantId  String
  quantity          Decimal         @db.Decimal(15, 4)
  reason            String?
  recordedAt        DateTime        @default(now())
  createdById       String?
  locationId        String?
  createdBy         User?           @relation(fields: [createdById], references: [id])
  location          Location?       @relation(fields: [locationId], references: [id])
  productVariant    ProductVariant  @relation(fields: [productVariantId], references: [id])
  productionOrder   ProductionOrder @relation(fields: [productionOrderId], references: [id])
}

model QualityInspection {
  id                String           @id @default(uuid())
  productionOrderId String
  inspectorId       String?
  result            InspectionResult
  notes             String?
  inspectedAt       DateTime         @default(now())
  inspector         User?            @relation(fields: [inspectorId], references: [id])
  productionOrder   ProductionOrder  @relation(fields: [productionOrderId], references: [id])
}

model ProductionMaterial {
  id                String          @id @default(uuid())
  productionOrderId String
  productVariantId  String
  quantity          Decimal         @db.Decimal(15, 4)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  productVariant    ProductVariant  @relation(fields: [productVariantId], references: [id])
  productionOrder   ProductionOrder @relation(fields: [productionOrderId], references: [id], onDelete: Cascade)

  @@index([productionOrderId])
  @@index([productVariantId])
}

model ProductionExecution {
  id                String          @id @default(uuid())
  productionOrderId String
  machineId         String?
  operatorId        String?
  shiftId           String?
  quantityProduced  Decimal         @db.Decimal(15, 4)
  scrapQuantity     Decimal         @default(0) @db.Decimal(15, 4)
  startTime         DateTime
  endTime           DateTime?
  notes             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  scrapDaunQty      Decimal         @default(0) @db.Decimal(15, 4)
  scrapProngkolQty  Decimal         @default(0) @db.Decimal(15, 4)
  machine           Machine?        @relation(fields: [machineId], references: [id])
  operator          Employee?       @relation("ExecutionOperator", fields: [operatorId], references: [id])
  productionOrder   ProductionOrder @relation(fields: [productionOrderId], references: [id], onDelete: Cascade)
  shift             WorkShift?      @relation(fields: [shiftId], references: [id])

  @@index([productionOrderId])
}

model WorkShift {
  id                   String                @id @default(uuid())
  name                 String
  startTime            String
  endTime              String
  status               WorkShiftStatus       @default(ACTIVE)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  productionExecutions ProductionExecution[]
}

model JobRole {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RolePermission {
  id        String   @id @default(uuid())
  role      Role
  resource  String
  canAccess Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([role, resource])
}

model AuditLog {
  id         String   @id @default(uuid())
  userId     String
  action     String
  entityType String
  entityId   String
  details    String?
  changes    Json?
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
}

model SalesOrder {
  id               String            @id @default(uuid())
  orderNumber      String            @unique
  customerId       String?
  orderDate        DateTime          @default(now())
  expectedDate     DateTime?
  orderType        SalesOrderType    @default(MAKE_TO_STOCK)
  status           SalesOrderStatus  @default(DRAFT)
  sourceLocationId String?
  totalAmount      Decimal?          @db.Decimal(15, 2)
  notes            String?
  createdById      String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  discountAmount   Decimal?          @db.Decimal(15, 2)
  taxAmount        Decimal?          @db.Decimal(15, 2)
  quotationId      String?
  deliveryOrders   DeliveryOrder[]
  invoices         Invoice[]
  productionOrders ProductionOrder[] @relation("SalesProduction")
  purchaseRequests PurchaseRequest[]
  createdBy        User?             @relation("SalesCreator", fields: [createdById], references: [id])
  customer         Customer?         @relation(fields: [customerId], references: [id])
  quotation        SalesQuotation?   @relation(fields: [quotationId], references: [id])
  sourceLocation   Location?         @relation("SalesSourceLocation", fields: [sourceLocationId], references: [id])
  items            SalesOrderItem[]
  movements        StockMovement[]   @relation("SalesMovement")
}

model SalesQuotation {
  id              String               @id @default(uuid())
  quotationNumber String               @unique
  customerId      String?
  quotationDate   DateTime             @default(now())
  validUntil      DateTime?
  status          SalesQuotationStatus @default(DRAFT)
  totalAmount     Decimal?             @db.Decimal(15, 2)
  discountAmount  Decimal?             @db.Decimal(15, 2)
  taxAmount       Decimal?             @db.Decimal(15, 2)
  notes           String?
  createdById     String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  salesOrders     SalesOrder[]
  createdBy       User?                @relation("QuotationCreator", fields: [createdById], references: [id])
  customer        Customer?            @relation(fields: [customerId], references: [id])
  items           SalesQuotationItem[]
}

model SalesQuotationItem {
  id               String         @id @default(uuid())
  salesQuotationId String
  productVariantId String
  quantity         Decimal        @db.Decimal(15, 4)
  unitPrice        Decimal        @db.Decimal(15, 2)
  discountPercent  Decimal?       @db.Decimal(5, 2)
  taxPercent       Decimal?       @db.Decimal(5, 2)
  taxAmount        Decimal?       @db.Decimal(15, 2)
  subtotal         Decimal        @db.Decimal(15, 2)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
  salesQuotation   SalesQuotation @relation(fields: [salesQuotationId], references: [id], onDelete: Cascade)
}

model SalesOrderItem {
  id               String         @id @default(uuid())
  salesOrderId     String
  productVariantId String
  quantity         Decimal        @db.Decimal(15, 4)
  unitPrice        Decimal        @db.Decimal(15, 2)
  subtotal         Decimal        @db.Decimal(15, 2)
  deliveredQty     Decimal        @default(0) @db.Decimal(15, 4)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  discountPercent  Decimal?       @db.Decimal(5, 2)
  taxAmount        Decimal?       @db.Decimal(15, 2)
  taxPercent       Decimal?       @db.Decimal(5, 2)
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
  salesOrder       SalesOrder     @relation(fields: [salesOrderId], references: [id], onDelete: Cascade)

  @@index([salesOrderId])
}

model Invoice {
  id                String        @id @default(uuid())
  invoiceNumber     String        @unique
  salesOrderId      String
  invoiceDate       DateTime      @default(now())
  dueDate           DateTime?
  status            InvoiceStatus @default(UNPAID)
  totalAmount       Decimal       @db.Decimal(15, 2)
  paidAmount        Decimal       @default(0) @db.Decimal(15, 2)
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  termOfPaymentDays Int           @default(0)
  salesOrder        SalesOrder    @relation(fields: [salesOrderId], references: [id])

  @@index([salesOrderId])
}

model PurchaseOrder {
  id               String              @id @default(uuid())
  orderNumber      String              @unique
  supplierId       String
  orderDate        DateTime            @default(now())
  expectedDate     DateTime?
  status           PurchaseOrderStatus @default(DRAFT)
  totalAmount      Decimal?            @db.Decimal(15, 2)
  notes            String?
  createdById      String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  goodsReceipts    GoodsReceipt[]
  invoices         PurchaseInvoice[]
  createdBy        User?               @relation("PurchaseCreator", fields: [createdById], references: [id])
  supplier         Supplier            @relation(fields: [supplierId], references: [id])
  items            PurchaseOrderItem[]
  purchaseRequests PurchaseRequest[]   @relation("PrToPo")
}

model PurchaseOrderItem {
  id               String         @id @default(uuid())
  purchaseOrderId  String
  productVariantId String
  quantity         Decimal        @db.Decimal(15, 4)
  unitPrice        Decimal        @db.Decimal(15, 4)
  subtotal         Decimal        @db.Decimal(15, 2)
  receivedQty      Decimal        @default(0) @db.Decimal(15, 4)
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
  purchaseOrder    PurchaseOrder  @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
}

model GoodsReceipt {
  id              String             @id @default(uuid())
  receiptNumber   String             @unique
  purchaseOrderId String
  receivedDate    DateTime           @default(now())
  locationId      String
  notes           String?
  createdById     String?
  createdAt       DateTime           @default(now())
  createdBy       User?              @relation("GoodsReceiptCreator", fields: [createdById], references: [id])
  location        Location           @relation(fields: [locationId], references: [id])
  purchaseOrder   PurchaseOrder      @relation(fields: [purchaseOrderId], references: [id])
  items           GoodsReceiptItem[]
  movements       StockMovement[]    @relation("GoodsReceiptMovement")
}

model GoodsReceiptItem {
  id               String         @id @default(uuid())
  goodsReceiptId   String
  productVariantId String
  receivedQty      Decimal        @db.Decimal(15, 4)
  unitCost         Decimal        @db.Decimal(15, 4)
  goodsReceipt     GoodsReceipt   @relation(fields: [goodsReceiptId], references: [id], onDelete: Cascade)
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
}

model PurchaseInvoice {
  id                String                @id @default(uuid())
  invoiceNumber     String                @unique
  purchaseOrderId   String
  invoiceDate       DateTime              @default(now())
  dueDate           DateTime?
  status            PurchaseInvoiceStatus @default(UNPAID)
  totalAmount       Decimal               @db.Decimal(15, 2)
  paidAmount        Decimal               @default(0) @db.Decimal(15, 2)
  notes             String?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  termOfPaymentDays Int                   @default(0)
  purchaseOrder     PurchaseOrder         @relation(fields: [purchaseOrderId], references: [id])
  payments          PurchasePayment[]
}

model PurchasePayment {
  id                String          @id @default(uuid())
  purchaseInvoiceId String
  amount            Decimal         @db.Decimal(15, 2)
  paymentDate       DateTime        @default(now())
  paymentMethod     String?
  reference         String?
  notes             String?
  createdById       String?
  createdAt         DateTime        @default(now())
  createdBy         User?           @relation("PaymentCreator", fields: [createdById], references: [id])
  purchaseInvoice   PurchaseInvoice @relation(fields: [purchaseInvoiceId], references: [id], onDelete: Cascade)

  @@index([purchaseInvoiceId])
}

model Account {
  id                  String          @id @default(uuid())
  code                String          @unique
  name                String
  description         String?
  type                AccountType
  category            AccountCategory
  parentId            String?
  isActive            Boolean         @default(true)
  isCashAccount       Boolean         @default(false)
  currency            String          @default("IDR")
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  parent              Account?        @relation("AccountHierarchy", fields: [parentId], references: [id])
  children            Account[]       @relation("AccountHierarchy")
  budgets             Budget[]
  accumDepreciation   FixedAsset[]    @relation("AccumDeprAccount")
  fixedAssets         FixedAsset[]    @relation("AssetAccount")
  depreciationExpense FixedAsset[]    @relation("DeprExpenseAccount")
  journalLines        JournalLine[]

  @@index([code])
  @@index([parentId])
}

model JournalEntry {
  id              String         @id @default(uuid())
  entryNumber     String         @unique
  entryDate       DateTime
  description     String
  reference       String?
  referenceType   ReferenceType?
  referenceId     String?
  status          JournalStatus  @default(DRAFT)
  isAutoGenerated Boolean        @default(false)
  createdById     String?
  approvedById    String?
  approvedAt      DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  approvedBy      User?          @relation("JournalApprover", fields: [approvedById], references: [id])
  createdBy       User?          @relation("JournalCreator", fields: [createdById], references: [id])
  lines           JournalLine[]

  @@index([entryDate])
  @@index([referenceType, referenceId])
}

model JournalLine {
  id             String       @id @default(uuid())
  journalEntryId String
  accountId      String
  description    String?
  debit          Decimal      @default(0) @db.Decimal(15, 2)
  credit         Decimal      @default(0) @db.Decimal(15, 2)
  currency       String       @default("IDR")
  exchangeRate   Decimal      @default(1) @db.Decimal(15, 6)
  createdAt      DateTime     @default(now())
  account        Account      @relation(fields: [accountId], references: [id])
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)

  @@index([journalEntryId])
  @@index([accountId])
}

model FiscalPeriod {
  id         String       @id @default(uuid())
  name       String
  startDate  DateTime
  endDate    DateTime
  year       Int
  month      Int
  status     PeriodStatus @default(OPEN)
  closedById String?
  closedAt   DateTime?

  @@unique([year, month])
}

model FixedAsset {
  id                               String      @id @default(uuid())
  assetCode                        String      @unique
  name                             String
  category                         String
  purchaseDate                     DateTime
  purchaseValue                    Decimal     @db.Decimal(15, 2)
  scrapValue                       Decimal     @default(0) @db.Decimal(15, 2)
  usefulLifeMonths                 Int
  depreciationMethod               String      @default("STRAIGHT_LINE")
  assetAccountId                   String
  depreciationAccountId            String
  accumulatedDepreciationAccountId String
  status                           AssetStatus @default(ACTIVE)
  locationId                       String?
  createdAt                        DateTime    @default(now())
  updatedAt                        DateTime    @updatedAt
  lastDepreciationDate             DateTime?
  accumDepreciationAccount         Account     @relation("AccumDeprAccount", fields: [accumulatedDepreciationAccountId], references: [id])
  assetAccount                     Account     @relation("AssetAccount", fields: [assetAccountId], references: [id])
  depreciationExpenseAccount       Account     @relation("DeprExpenseAccount", fields: [depreciationAccountId], references: [id])
  location                         Location?   @relation(fields: [locationId], references: [id])
}

model Budget {
  id        String   @id @default(uuid())
  accountId String
  year      Int
  month     Int
  amount    Decimal  @db.Decimal(15, 2)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  account   Account  @relation(fields: [accountId], references: [id])

  @@unique([accountId, year, month])
}

model DeliveryOrder {
  id               String              @id @default(uuid())
  orderNumber      String              @unique
  salesOrderId     String
  deliveryDate     DateTime            @default(now())
  status           DeliveryStatus      @default(PENDING)
  trackingNumber   String?
  carrier          String?
  sourceLocationId String
  createdById      String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  notes            String?
  createdBy        User?               @relation("DeliveryCreator", fields: [createdById], references: [id])
  salesOrder       SalesOrder          @relation(fields: [salesOrderId], references: [id])
  sourceLocation   Location            @relation(fields: [sourceLocationId], references: [id])
  items            DeliveryOrderItem[]

  @@index([salesOrderId])
}

model DeliveryOrderItem {
  id               String         @id @default(uuid())
  deliveryOrderId  String
  productVariantId String
  quantity         Decimal        @db.Decimal(15, 4)
  notes            String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  deliveryOrder    DeliveryOrder  @relation(fields: [deliveryOrderId], references: [id], onDelete: Cascade)
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])
}

model PurchaseRequest {
  id              String                @id @default(uuid())
  requestNumber   String                @unique
  requestDate     DateTime              @default(now())
  status          PurchaseRequestStatus @default(OPEN)
  priority        String                @default("NORMAL")
  notes           String?
  salesOrderId    String?
  convertedToPoId String?
  createdById     String
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  purchaseOrder   PurchaseOrder?        @relation("PrToPo", fields: [convertedToPoId], references: [id])
  createdBy       User                  @relation(fields: [createdById], references: [id])
  salesOrder      SalesOrder?           @relation(fields: [salesOrderId], references: [id])
  items           PurchaseRequestItem[]
}

model PurchaseRequestItem {
  id                String          @id @default(uuid())
  purchaseRequestId String
  productVariantId  String
  quantity          Decimal         @db.Decimal(15, 4)
  notes             String?
  productVariant    ProductVariant  @relation(fields: [productVariantId], references: [id])
  purchaseRequest   PurchaseRequest @relation(fields: [purchaseRequestId], references: [id], onDelete: Cascade)
}

enum BomCategory {
  STANDARD
  MIXING
  EXTRUSION
  PACKING
}

enum ProductionIssueType {
  MACHINE_BREAKDOWN
  MATERIAL_DEFECT
  QUALITY_ISSUE
  OPERATOR_ERROR
  OTHER
}

enum IssueStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
}



enum DeliveryStatus {
  PENDING
  SHIPPED
  DELIVERED
  RETURNED
  CANCELLED
}

enum Role {
  ADMIN
  WAREHOUSE
  PRODUCTION
  SALES
  PLANNING
  FINANCE
  PROCUREMENT
}

enum ProductType {
  RAW_MATERIAL
  INTERMEDIATE
  PACKAGING
  WIP
  FINISHED_GOOD
  SCRAP
}

enum Unit {
  KG
  ROLL
  BAL
  PCS
  ZAK
}

enum MovementType {
  IN
  OUT
  TRANSFER
  ADJUSTMENT
  PURCHASE
}

enum MachineType {
  MIXER
  EXTRUDER
  REWINDER
  PACKER
  GRANULATOR
}

enum MachineStatus {
  ACTIVE
  MAINTENANCE
  BROKEN
}

enum OpnameStatus {
  OPEN
  COMPLETED
  CANCELLED
}

enum BatchStatus {
  ACTIVE
  QUARANTINE
  EXPIRED
  CONSUMED
}

enum ReservationType {
  SALES_ORDER
  PRODUCTION_ORDER
  TRANSFER_ORDER
}

enum ReservationStatus {
  ACTIVE
  FULFILLED
  CANCELLED
  EXPIRED
  WAITING
}

enum ProductionStatus {
  DRAFT
  RELEASED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  WAITING_MATERIAL
}

enum InspectionResult {
  PASS
  FAIL
  QUARANTINE
}

enum CostingMethod {
  WEIGHTED_AVERAGE
  STANDARD_COST
}

enum EmployeeStatus {
  ACTIVE
  INACTIVE
}

enum WorkShiftStatus {
  ACTIVE
  INACTIVE
}

enum SalesQuotationStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
  CONVERTED
}

enum SalesOrderType {
  MAKE_TO_STOCK
  MAKE_TO_ORDER
}

enum SalesOrderStatus {
  DRAFT
  CONFIRMED
  IN_PRODUCTION
  READY_TO_SHIP
  SHIPPED
  DELIVERED
  CANCELLED
}

enum InvoiceStatus {
  UNPAID
  PARTIAL
  PAID
  CANCELLED
  OVERDUE
  DRAFT
}

enum PurchaseOrderStatus {
  DRAFT
  SENT
  PARTIAL_RECEIVED
  RECEIVED
  CANCELLED
}

enum PurchaseInvoiceStatus {
  UNPAID
  PARTIAL
  PAID
  CANCELLED
  OVERDUE
  DRAFT
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum AccountCategory {
  CURRENT_ASSET
  FIXED_ASSET
  OTHER_ASSET
  CURRENT_LIABILITY
  LONG_TERM_LIABILITY
  CAPITAL
  RETAINED_EARNINGS
  OPERATING_REVENUE
  OTHER_REVENUE
  COGS
  OPERATING_EXPENSE
  OTHER_EXPENSE
}

enum ReferenceType {
  SALES_INVOICE
  SALES_PAYMENT
  PURCHASE_INVOICE
  PURCHASE_PAYMENT
  GOODS_RECEIPT
  STOCK_ADJUSTMENT
  PRODUCTION_OUTPUT
  MATERIAL_ISSUE
  MANUAL_ENTRY
}

enum JournalStatus {
  DRAFT
  POSTED
  VOIDED
}

enum PeriodStatus {
  OPEN
  CLOSED
  LOCKED
}

enum AssetStatus {
  ACTIVE
  FULLY_DEPRECIATED
  DISPOSED
  MAINTENANCE
}

enum PurchaseRequestStatus {
  OPEN
  APPROVED
  REJECTED
  CONVERTED
}

model SystemSequence {
  id        String   @id @default(uuid())
  key       String   @unique
  value     BigInt   @default(0)
  updatedAt DateTime @updatedAt
}
